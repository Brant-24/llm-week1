# ğŸš€ LLM Week1

> ä¸€ä¸ªåŸºäºå¤§è¯­è¨€æ¨¡å‹çš„ç¤ºä¾‹é¡¹ç›®  
> æä¾›å¯¹è¯ã€æ”¹å†™ã€åˆ†ç±»ã€RAG é—®ç­”ç­‰ HTTP æ¥å£ï¼Œå¹¶æ”¯æŒ **Qwen3-4B LoRA å¾®è°ƒ**ã€‚  
> é€‚åˆä½œä¸º LLM åº”ç”¨å…¥é—¨ä¸å®éªŒé¡¹ç›®ã€‚

---

## âœ¨ é¡¹ç›®äº®ç‚¹

- æœ¬åœ°éƒ¨ç½²å¤§æ¨¡å‹ï¼ˆOllamaï¼‰
- å®Œæ•´ RAG æµç¨‹å®ç°ï¼ˆEmbedding + å‘é‡æ£€ç´¢ + ç”Ÿæˆï¼‰
- æ”¯æŒ LoRA å¾®è°ƒï¼ˆ4bit é‡åŒ–ï¼‰
- Node.js åç«¯ + Python è®­ç»ƒè„šæœ¬
- ç»“æ„æ¸…æ™°ï¼Œé€‚åˆå­¦ä¹ ä¸äºŒæ¬¡å¼€å‘

---

## ğŸ“¦ åŠŸèƒ½æ¦‚è§ˆ

| æ¥å£             | åŠŸèƒ½è¯´æ˜                              |
| ---------------- | ------------------------------------- |
| `POST /chat`     | é€šç”¨å¯¹è¯                              |
| `POST /rewrite`  | æ–‡æ¡ˆæ”¹å†™ï¼ˆæ”¯æŒé£æ ¼æŒ‡å®šï¼‰              |
| `POST /classify` | æ–‡æœ¬åˆ†ç±»ï¼ˆæŠ€æœ¯ / æƒ…æ„Ÿ / å¹¿å‘Š / åƒåœ¾ï¼‰ |
| `POST /rag`      | åŸºäºæœ¬åœ°æ–‡æ¡£çš„ RAG é—®ç­”               |

---

## ğŸ§± æŠ€æœ¯æ ˆ

### ğŸ–¥ åç«¯
- Node.js
- Koa
- koa-router

### ğŸ¤– å¤§æ¨¡å‹
- Ollama æœ¬åœ°æ¨¡å‹è°ƒç”¨
- é»˜è®¤æ¨¡å‹ï¼š`qwen3:4b`

### ğŸ“š RAG å®ç°
- Embedding æ¨¡å‹ï¼š`nomic-embed-text`
- å›ºå®šé•¿åº¦åˆ†å—ï¼ˆé»˜è®¤ 300 å­—ï¼‰
- å†…å­˜å‘é‡åº“
- ä½™å¼¦ç›¸ä¼¼åº¦æ£€ç´¢ï¼ˆTop 3ï¼‰

### ğŸ§  å¾®è°ƒ
- Transformers
- PEFTï¼ˆLoRAï¼‰
- 4bit é‡åŒ–ï¼ˆBitsAndBytesï¼‰

---

## âš™ï¸ ç¯å¢ƒå‡†å¤‡

### 1ï¸âƒ£ å®‰è£… Ollama

å®‰è£…ï¼šhttps://ollama.com/

æ‹‰å–æ¨¡å‹ï¼š

```bash
ollama pull qwen3:4b
ollama pull nomic-embed-text
```

---

### 2ï¸âƒ£ å®‰è£… Node ä¾èµ–

```bash
npm install
```

---

### 3ï¸âƒ£ å‡†å¤‡ RAG æ–‡æ¡£

å°†éœ€è¦æ£€ç´¢çš„å†…å®¹æ”¾å…¥ï¼š

```
docs/demo.txt
```

æœåŠ¡å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨ï¼š

- è¯»å–æ–‡æ¡£
- åˆ†å—
- å‘é‡åŒ–
- å­˜å…¥å†…å­˜å‘é‡åº“

---

## â–¶ï¸ å¯åŠ¨æœåŠ¡

```bash
node index.js
```

è®¿é—®åœ°å€ï¼š

```
http://localhost:3000
```

å¯åŠ¨æˆåŠŸåä¼šè¾“å‡ºï¼š

```
æ–‡æ¡£å‘é‡åŒ–å®Œæˆ
```

---

## ğŸ“¡ API ç¤ºä¾‹

---

### ğŸ—¨ 1. å¯¹è¯æ¥å£

#### `POST /chat`

è¯·æ±‚ï¼š

```json
{
  "message": "ä½ å¥½"
}
```

è¿”å›ï¼š

```json
{
  "answer": "æ¨¡å‹å›å¤"
}
```

æµ‹è¯•ï¼š

```bash
curl -X POST http://localhost:3000/chat \
-H "Content-Type: application/json" \
-d "{\"message\":\"ä½ å¥½\"}"
```

---

### âœï¸ 2. æ”¹å†™æ¥å£

#### `POST /rewrite`

è¯·æ±‚ï¼š

```json
{
  "message": "ä»Šå¤©å¤©æ°”å¾ˆå¥½",
  "style": "æ­£å¼"
}
```

è¿”å›ï¼š

```json
{
  "result": "æ”¹å†™åçš„æ–‡æ¡ˆ"
}
```

---

### ğŸ· 3. åˆ†ç±»æ¥å£

#### `POST /classify`

è¿”å›æ ¼å¼ï¼š

```json
{
  "label": "æŠ€æœ¯",
  "confidence": 0.95
}
```

è‹¥è¾“å‡ºéæ³• JSONï¼š

```json
{
  "error": "...",
  "raw": "åŸå§‹è¾“å‡º"
}
```

---

### ğŸ“š 4. RAG é—®ç­”æ¥å£

#### `POST /rag`

è¿”å›æ ¼å¼ï¼š

```json
{
  "answer": "åŸºäºæ–‡æ¡£çš„å›ç­”",
  "references": ["ç‰‡æ®µ1", "ç‰‡æ®µ2"]
}
```

ç‰¹ç‚¹ï¼š

- ä»…åŸºäº `docs/demo.txt`
- è‹¥æ— ç­”æ¡ˆè¿”å›ã€Œä¸çŸ¥é“ã€

---

## ğŸ” RAG æµç¨‹è¯´æ˜

### å¯åŠ¨é˜¶æ®µ

```
demo.txt
   â†“
åˆ†å—ï¼ˆ300 å­—ï¼‰
   â†“
Embedding
   â†“
å­˜å…¥å‘é‡åº“
```

### è¯·æ±‚é˜¶æ®µ

```
ç”¨æˆ·é—®é¢˜
   â†“
å‘é‡åŒ–
   â†“
ç›¸ä¼¼åº¦æ£€ç´¢ï¼ˆTop3ï¼‰
   â†“
æ‹¼æ¥ Prompt
   â†“
LLM ç”Ÿæˆç­”æ¡ˆ
```

---

## ğŸ§ª å‰ç«¯å¿«é€Ÿæµ‹è¯•

é¡¹ç›®å†…æä¾›ï¼š

```
test.html
```

- ä½¿ç”¨ axios è°ƒç”¨æ¥å£
- æ‰“å¼€æµè§ˆå™¨å³å¯æµ‹è¯•
- ç¡®ä¿åç«¯è¿è¡Œåœ¨ `localhost:3000`

---

## ğŸ§  LoRA å¾®è°ƒ

åŸºäºï¼š

```
Qwen/Qwen3-4B
```

é…ç½®ï¼š

- LoRA ä½œç”¨å±‚ï¼š`q_proj`ã€`v_proj`
- r = 8
- 4bit é‡åŒ–

---

### ğŸ“„ æ•°æ®æ ¼å¼

`data/train.jsonl`

```json
{"instruction":"ç”¨å·¥ç¨‹å¸ˆå£å»è§£é‡Šæ¦‚å¿µ","input":"RAG æ˜¯ä»€ä¹ˆï¼Ÿ","output":"RAGï¼ˆRetrieval-Augmented Generationï¼‰æ˜¯..."}
```

---

### ğŸ“¦ å®‰è£… Python ä¾èµ–

å»ºè®®ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼š

```bash
pip install transformers peft datasets torch bitsandbytes
```

---

### ğŸš€ å¼€å§‹è®­ç»ƒ

```bash
python train_lora_qwen3.py
```

è¾“å‡ºç›®å½•ï¼š

```
qwen3-lora/
```

å¯åœ¨è„šæœ¬å†…è°ƒæ•´ï¼š

- `num_train_epochs`
- `learning_rate`
- `per_device_train_batch_size`

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ index.js
â”œâ”€â”€ chat.js
â”œâ”€â”€ rewrite.js
â”œâ”€â”€ classify.js
â”œâ”€â”€ rag.js
â”œâ”€â”€ llm.js
â”œâ”€â”€ embedding.js
â”œâ”€â”€ vectorStore.js
â”œâ”€â”€ loadDocs.js
â”œâ”€â”€ chunk.js
â”œâ”€â”€ data/
â”‚   â””â”€â”€ train.jsonl
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ demo.txt
â”œâ”€â”€ train_lora_qwen3.py
â”œâ”€â”€ qwen3-lora/
â”œâ”€â”€ test.html
â””â”€â”€ package.json
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

- å¿…é¡»ä¿è¯ Ollama å·²å¯åŠ¨
- å·²æ‹‰å– `qwen3:4b`
- RAG éœ€è¦ `nomic-embed-text`
- å‘é‡åº“å­˜å‚¨åœ¨å†…å­˜ï¼Œé‡å¯ä¼šé‡æ–°åŠ è½½
- åˆ†ç±»æ¥å£ä¾èµ–æ¨¡å‹è¾“å‡º JSONï¼Œå¿…è¦æ—¶å¯åŠ å¼º prompt çº¦æŸ
